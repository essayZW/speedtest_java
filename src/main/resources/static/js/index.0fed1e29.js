(function(e){function t(t){for(var i,o,a=t[0],l=t[1],d=t[2],c=0,h=[];c<a.length;c++)o=a[c],Object.prototype.hasOwnProperty.call(n,o)&&n[o]&&h.push(n[o][0]),n[o]=0;for(i in l)Object.prototype.hasOwnProperty.call(l,i)&&(e[i]=l[i]);u&&u(t);while(h.length)h.shift()();return s.push.apply(s,d||[]),r()}function r(){for(var e,t=0;t<s.length;t++){for(var r=s[t],i=!0,a=1;a<r.length;a++){var l=r[a];0!==n[l]&&(i=!1)}i&&(s.splice(t--,1),e=o(o.s=r[0]))}return e}var i={},n={index:0},s=[];function o(t){if(i[t])return i[t].exports;var r=i[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,o),r.l=!0,r.exports}o.m=e,o.c=i,o.d=function(e,t,r){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)o.d(r,i,function(t){return e[t]}.bind(null,i));return r},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/";var a=window["webpackJsonp"]=window["webpackJsonp"]||[],l=a.push.bind(a);a.push=t,a=a.slice();for(var d=0;d<a.length;d++)t(a[d]);var u=l;s.push([0,"chunk-vendors"]),r()})({0:function(e,t,r){e.exports=r("df31")},df31:function(e,t,r){"use strict";r.r(t);r("e260"),r("e6cf"),r("cca6"),r("a79d");var i=r("2b0e"),n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"app"}},[r("el-container",[r("el-header",[e._v("Header")]),r("el-main",[r("Speedtest")],1),r("el-footer",[e._v("Footer")])],1)],1)},s=[],o=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"testWrapper"}},[r("el-button",{attrs:{type:e.startButtonType,disabled:e.startButtonForbidden},on:{click:e.startStop}},[e._v(e._s(e.startButtonStart?"结束":"开始"))]),r("br"),r("div",{attrs:{id:"serverSelectArea"}},[r("div",[r("label",{attrs:{for:"serverList"}},[e._v("Server:")]),r("el-select",{attrs:{placeholder:"请选择"},model:{value:e.changeServerId,callback:function(t){e.changeServerId=t},expression:"changeServerId"}},e._l(e.serverLists,(function(t){return r("el-option",{key:t.id,attrs:{value:t.id,label:t.name},on:{change:e.changeServer}})})),1)],1)]),r("div",{attrs:{id:"test"}},[r("div",{staticClass:"testGroup"},[r("div",{staticClass:"testArea2"},[r("div",{staticClass:"testName"},[e._v("Ping")]),r("div",{staticClass:"meterText",staticStyle:{color:"#aa6060"},attrs:{id:"pingText"}},[e._v(" "+e._s(e.pingText)+" ")]),r("div",{staticClass:"unit"},[e._v("ms")])]),r("div",{staticClass:"testArea2"},[r("div",{staticClass:"testName"},[e._v("Jitter")]),r("div",{staticClass:"meterText",staticStyle:{color:"#aa6060"},attrs:{id:"jitText"}},[e._v(" "+e._s(e.jitterText)+" ")]),r("div",{staticClass:"unit"},[e._v("ms")])])]),r("div",{staticClass:"testGroup"},[r("div",{staticClass:"testArea"},[r("div",{staticClass:"testName"},[e._v("Download")]),r("canvas",{staticClass:"meter",attrs:{id:"dlMeter"}}),r("div",{staticClass:"meterText",attrs:{id:"dlText"}},[e._v(e._s(e.dlText))]),r("div",{staticClass:"unit"},[e._v("Mbps")])]),r("div",{staticClass:"testArea"},[r("div",{staticClass:"testName"},[e._v("Upload")]),r("canvas",{staticClass:"meter",attrs:{id:"ulMeter"}}),r("div",{staticClass:"meterText",attrs:{id:"ulText"}},[e._v(e._s(e.ulText))]),r("div",{staticClass:"unit"},[e._v("Mbps")])])]),r("div",{attrs:{id:"ipArea"}},[r("div",{attrs:{id:"ipAndIsp"}},[e._v(e._s(e.ipAndIspContent))]),r("div",{attrs:{id:"ipPositionAndAccessMethod"}},[e._v(" "+e._s(e.ipPositionAndAccessMethodContent)+" ")])])])],1)},a=[],l=(r("a9e3"),r("b680"),r("b0c0"),r("ac1f"),r("466d"),r("ecd6")),d=r.n(l);function u(){return d()('(function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/",r(r.s="87fd")})({"87fd":function(e,t){var r=-1,n="",o="",i="",a="",l="",s=0,u=0,d=0,c=null,p="",f="",m="",g="";function _(e){y.telemetry_level>=2&&(g+=Date.now()+": "+e+"\\n")}function h(e){y.telemetry_level>=3&&(g+=Date.now()+": "+e+"\\n")}function v(e){y.telemetry_level>=2&&(g+=Date.now()+" WARN: "+e+"\\n"),console.warn(e)}var y={mpot:!1,test_order:"IP_D_U",time_ul_max:15,time_dl_max:15,time_auto:!0,time_ulGraceTime:3,time_dlGraceTime:1.5,count_ping:10,url_dl:"/speed/api/download",url_ul:"/speed/api/empty",url_ping:"/speed/api/empty",url_getIp:"/speed/api/ip",getIp_ispInfo:!0,getIp_ispInfo_distance:"km",xhr_dlMultistream:6,xhr_ulMultistream:3,xhr_multistreamDelay:300,xhr_ignoreErrors:1,xhr_dlUseBlob:!1,xhr_ul_blob_megabytes:20,garbagePhp_chunkSize:100,enable_quirks:!0,ping_allowPerformanceApi:!0,overheadCompensationFactor:1.06,useMebibits:!1,telemetry_level:0,url_telemetry:"/api/history",telemetry_extra:"",server_id:null},b=null,w=null,x=0;function T(e){return e.match(/\\?/)?"&":"?"}function M(){if(h("stopping pending XHRs"),b){for(var e=0;e<b.length;e++){try{b[e].onprogress=null,b[e].onload=null,b[e].onerror=null}catch(t){console.error(t)}try{b[e].upload.onprogress=null,b[e].upload.onload=null,b[e].upload.onerror=null}catch(t){console.error(t)}try{b[e].abort()}catch(t){console.error(t)}try{delete b[e]}catch(t){console.error(t)}}b=null}}self.addEventListener("message",(function(e){var t=e.data.split(" ");if("status"===t[0]&&postMessage(JSON.stringify({testState:r,dlStatus:n,ulStatus:o,pingStatus:i,clientIp:l,isp:m,ipPosition:p,ipAccessMethod:f,jitterStatus:a,dlProgress:s,ulProgress:u,pingProgress:d,testId:c})),"start"===t[0]&&-1===r){r=0;try{var g={};try{var b=e.data.substring(5);b&&(g=JSON.parse(b))}catch(e){v("Error parsing custom settings JSON. Please check your syntax")}for(var T in g)"undefined"!==typeof y[T]?y[T]=g[T]:v("Unknown setting ignored: "+T);var P=navigator.userAgent;(y.enable_quirks||"undefined"!==typeof g.enable_quirks&&g.enable_quirks)&&(/Firefox.(\\d+\\.\\d+)/i.test(P)&&"undefined"===typeof g.ping_allowPerformanceApi&&(y.ping_allowPerformanceApi=!1),/Edge.(\\d+\\.\\d+)/i.test(P)&&"undefined"===typeof g.xhr_dlMultistream&&(y.xhr_dlMultistream=3),/Chrome.(\\d+)/i.test(P)&&self.fetch&&"undefined"===typeof g.xhr_dlMultistream&&(y.xhr_dlMultistream=5)),/Edge.(\\d+\\.\\d+)/i.test(P)&&(y.forceIE11Workaround=!0),/PlayStation 4.(\\d+\\.\\d+)/i.test(P)&&(y.forceIE11Workaround=!0),/Chrome.(\\d+)/i.test(P)&&/Android|iPhone|iPad|iPod|Windows Phone/i.test(P)&&(y.xhr_ul_blob_megabytes=4),/^((?!chrome|android|crios|fxios).)*safari/i.test(P)&&(y.forceIE11Workaround=!0),"undefined"!==typeof g.telemetry_level&&(y.telemetry_level="basic"===g.telemetry_level?1:"full"===g.telemetry_level?2:"debug"===g.telemetry_level?3:0),y.test_order=y.test_order.toUpperCase()}catch(e){v("Possible error in custom test settings. Some settings might not have been applied. Exception: "+e)}h(JSON.stringify(y)),x=0;var I=!1,S=!1,E=!1,A=!1,N=function(){if(5!=r)if(x>=y.test_order.length)y.telemetry_level>0?q((function(e){r=4,null!=e&&(c=e)})):r=4;else switch(y.test_order.charAt(x)){case"I":if(x++,I)return void N();I=!0,k(N);break;case"D":if(x++,S)return void N();S=!0,r=1,D(N);break;case"U":if(x++,E)return void N();E=!0,r=3,O(N);break;case"P":if(x++,A)return void N();A=!0,r=2,F(N);break;case"_":x++,setTimeout(N,1e3);break;default:x++}};N()}if("abort"===t[0]){if(r>=4)return;_("manually aborted"),M(),N=null,w&&clearInterval(w),y.telemetry_level>1&&q((function(){})),r=5,n="",o="",i="",a="",l="",m="",p="",f="",s=0,u=0,d=0}}));var P=!1,I="";function k(e){if(h("getIp"),!P){P=!0;var t=(new Date).getTime();b=new XMLHttpRequest,b.onload=function(){_("IP: "+b.responseText+", took "+((new Date).getTime()-t)+"ms");try{var r=JSON.parse(b.responseText).data;l=r.ip,null!=l&&void 0!=l||(l="Unknown"),m=r.isp,null!=m&&void 0!=m||(m="Unknown"),p=r.position,null!=p&&void 0!=p||(p="Unknown"),f=r.accessMethod,null!=f&&void 0!=p||(f="Unknown")}catch(n){l="Failed to get IP",I=""}e()},b.onerror=function(){_("getIp failed, took "+((new Date).getTime()-t)+"ms"),e()},b.open("GET",y.url_getIp+T(y.url_getIp)+(y.mpot?"cors=true&":"")+(y.getIp_ispInfo?"isp=true"+(y.getIp_ispInfo_distance?"&distance="+y.getIp_ispInfo_distance+"&":"&"):"&")+"r="+Math.random(),!0),b.send()}}var S=!1;function D(e){if(h("dlTest"),!S){S=!0;var t=0,o=(new Date).getTime(),i=0,a=!1,l=!1;b=[];for(var u=function(e,n){setTimeout(function(){if(1===r){h("dl test stream started "+e+" "+n);var o=0,i=new XMLHttpRequest;b[e]=i,b[e].onprogress=function(n){if(h("dl stream progress event "+e+" "+n.loaded),1!==r)try{i.abort()}catch(l){console.error(l)}var a=n.loaded<=0?0:n.loaded-o;isNaN(a)||!isFinite(a)||a<0||(t+=a,o=n.loaded)}.bind(this),b[e].onload=function(){h("dl stream finished "+e);try{b[e].abort()}catch(t){console.error(t)}u(e,0)}.bind(this),b[e].onerror=function(){h("dl stream failed "+e),0===y.xhr_ignoreErrors&&(l=!0);try{b[e].abort()}catch(t){console.error(t)}delete b[e],1===y.xhr_ignoreErrors&&u(e,0)}.bind(this);try{y.xhr_dlUseBlob?b[e].responseType="blob":b[e].responseType="arraybuffer"}catch(a){console.error(a)}b[e].open("GET",y.url_dl+T(y.url_dl)+(y.mpot?"cors=true&":"")+"r="+Math.random()+"&ckSize="+y.garbagePhp_chunkSize,!0),b[e].send()}}.bind(this),1+n)}.bind(this),d=0;d<y.xhr_dlMultistream;d++)u(d,y.xhr_multistreamDelay*d);w=setInterval(function(){h("DL: "+n+(a?"":" (in grace time)"));var r=(new Date).getTime()-o;if(a&&(s=(r+i)/(1e3*y.time_dl_max)),!(r<200))if(a){var u=t/(r/1e3);if(y.time_auto){var d=6.4*u/1e5;i+=d>800?800:d}n=(8*u*y.overheadCompensationFactor/(y.useMebibits?1048576:1e6)).toFixed(2),((r+i)/1e3>y.time_dl_max||l)&&((l||isNaN(n))&&(n="Fail"),M(),clearInterval(w),s=1,_("dlTest: "+n+", took "+((new Date).getTime()-o)+"ms"),e())}else r>1e3*y.time_dlGraceTime&&(t>0&&(o=(new Date).getTime(),i=0,t=0),a=!0)}.bind(this),200)}}var E=!1;function O(e){if(h("ulTest"),!E){E=!0;var t=new ArrayBuffer(1048576),n=Math.pow(2,32)-1;try{t=new Uint32Array(t);for(var i=0;i<t.length;i++)t[i]=Math.random()*n}catch(d){console.error(d)}var a=[],l=[];for(let e=0;e<y.xhr_ul_blob_megabytes;e++)a.push(t);a=new Blob(a),t=new ArrayBuffer(262144);try{t=new Uint32Array(t);for(let e=0;e<t.length;e++)t[e]=Math.random()*n}catch(d){console.error(d)}l.push(t),l=new Blob(l);var s=function(){var t=0,n=(new Date).getTime(),i=0,s=!1,c=!1;b=[];for(var p=function(e,n){setTimeout(function(){if(3===r){h("ul test stream started "+e+" "+n);var o,i=0,s=new XMLHttpRequest;if(b[e]=s,y.forceIE11Workaround)o=!0;else try{b[e].upload.onprogress,o=!1}catch(d){o=!0}if(o){b[e].onload=b[e].onerror=function(){h("ul stream progress event (ie11wa)"),t+=l.size,p(e,0)},b[e].open("POST",y.url_ul+T(y.url_ul)+(y.mpot?"cors=true&":"")+"r="+Math.random(),!0);try{b[e].setRequestHeader("Content-Encoding","identity")}catch(d){console.error(d)}b[e].send(l)}else{b[e].upload.onprogress=function(n){if(h("ul stream progress event "+e+" "+n.loaded),3!==r)try{s.abort()}catch(d){console.error(d)}var o=n.loaded<=0?0:n.loaded-i;isNaN(o)||!isFinite(o)||o<0||(t+=o,i=n.loaded)}.bind(this),b[e].upload.onload=function(){h("ul stream finished "+e),p(e,0)}.bind(this),b[e].upload.onerror=function(){h("ul stream failed "+e),0===y.xhr_ignoreErrors&&(c=!0);try{b[e].abort()}catch(d){console.error(d)}delete b[e],1===y.xhr_ignoreErrors&&p(e,0)}.bind(this),b[e].open("POST",y.url_ul+T(y.url_ul)+(y.mpot?"cors=true&":"")+"r="+Math.random(),!0);try{b[e].setRequestHeader("Content-Encoding","identity")}catch(d){console.error(d)}b[e].send(a)}}}.bind(this),n)}.bind(this),f=0;f<y.xhr_ulMultistream;f++)p(f,y.xhr_multistreamDelay*f);w=setInterval(function(){h("UL: "+o+(s?"":" (in grace time)"));var r=(new Date).getTime()-n;if(s&&(u=(r+i)/(1e3*y.time_ul_max)),!(r<200))if(s){var a=t/(r/1e3);if(y.time_auto){var l=6.4*a/1e5;i+=l>800?800:l}o=(8*a*y.overheadCompensationFactor/(y.useMebibits?1048576:1e6)).toFixed(2),((r+i)/1e3>y.time_ul_max||c)&&((c||isNaN(o))&&(o="Fail"),M(),clearInterval(w),u=1,_("ulTest: "+o+", took "+((new Date).getTime()-n)+"ms"),e())}else r>1e3*y.time_ulGraceTime&&(t>0&&(n=(new Date).getTime(),i=0,t=0),s=!0)}.bind(this),200)}.bind(this);y.mpot?(h("Sending POST request before performing upload test"),b=[],b[0]=new XMLHttpRequest,b[0].onload=b[0].onerror=function(){h("POST request sent, starting upload test"),s()}.bind(this),b[0].open("POST",y.url_ul+"?cors=true"),b[0].send()):s()}}var A=!1;function F(e){if(h("pingTest"),!A){A=!0;var t=(new Date).getTime(),r=null,n=0,o=0,l=0,s=0;b=[];var u=function(){h("ping"),d=l/y.count_ping,r=(new Date).getTime(),b[0]=new XMLHttpRequest,b[0].onload=function(){if(h("pong"),0===l)r=(new Date).getTime();else{var c=(new Date).getTime()-r;if(y.ping_allowPerformanceApi)try{var p=performance.getEntries();p=p[p.length-1];var f=p.responseStart-p.requestStart;f<=0&&(f=p.duration),f>0&&f<c&&(c=f)}catch(g){h("Performance API not supported, using estimate")}c<1&&(c=s),c<1&&(c=1);var m=Math.abs(c-s);1===l?n=c:(c<n&&(n=c),o=2===l?m:.9365*o+.0625*m),s=c}i=n.toFixed(2),a=o.toFixed(2),l++,h("ping: "+i+" jitter: "+a),l<y.count_ping?u():(d=1,_("ping: "+i+" jitter: "+a+", took "+((new Date).getTime()-t)+"ms"),e())}.bind(this),b[0].onerror=function(){h("ping failed"),0===y.xhr_ignoreErrors&&(i="Fail",a="Fail",M(),_("ping test failed, took "+((new Date).getTime()-t)+"ms"),d=1,e()),1===y.xhr_ignoreErrors&&u(),2===y.xhr_ignoreErrors&&(l++,l<y.count_ping?u():(d=1,_("ping: "+i+" jitter: "+a+", took "+((new Date).getTime()-t)+"ms"),e()))}.bind(this),b[0].open("GET",y.url_ping+T(y.url_ping)+(y.mpot?"cors=true&":"")+"r="+Math.random(),!0),b[0].send()}.bind(this);u()}}function q(e){if(!(y.telemetry_level<1)){b=new XMLHttpRequest,b.onload=function(){try{var t=b.responseText.split(" ");if("id"==t[0])try{var r=t[1];e(r)}catch(n){e(null)}else e(null)}catch(n){e(null)}},b.onerror=function(){console.log("TELEMETRY ERROR "+b.status),e(null)},b.open("POST",y.url_telemetry+T(y.url_telemetry)+(y.mpot?"cors=true&":"")+"r="+Math.random(),!0);try{var t=new FormData;t.append("ip",l),t.append("dl",n),t.append("ul",o),t.append("ping",i),t.append("jitter",a),t.append("ua",navigator.userAgent),t.append("testPointId",y.server_id),t.append("extraAttribute",JSON.stringify({isp:m,position:p,accessMethod:f})),b.send(t),console.log(g),console.log(I)}catch(r){console.error(r)}}}}});\n//# sourceMappingURL=speedtest.worker.573ca6e5.worker.js.map',"Worker",void 0,r.p+"static/js/speedtest.worker.573ca6e5.worker.js")}var c=function(){this._serverList=[],this._selectedServer=null,this._settings={},this._state=0,console.log("LibreSpeed by Federico Dossena v5.2 - https://github.com/librespeed/speedtest")};c.prototype={constructor:c,getState:function(){return this._state},setParameter:function(e,t){if(0!=this._state)throw"You cannot change the test settings after adding server or starting the test";this._settings[e]=t,"temeletry_extra"===e&&(this._originalExtra=this._settings.telemetry_extra)},_checkServerDefinition:function(e){try{if("string"!==typeof e.name)throw"Name string missing from server definition (name)";if("string"!==typeof e.server)throw"Server address string missing from server definition (server)";if("/"==e.server.charAt(e.server.length-1)&&(e.server=e.server.substr(0,e.server.length-1)),!/^(http:\/\/|https:\/\/).+$/.test(e.server))throw"Server address string must start with http:// or https://";if("string"!==typeof e.dlURL)throw"Download URL string missing from server definition (dlURL)";if("/"!=e.dlURL.charAt(0)&&(e.dlURL="/"+e.dlURL),"string"!==typeof e.ulURL)throw"Upload URL string missing from server definition (ulURL)";if("/"!=e.ulURL.charAt(0)&&(e.ulURL="/"+e.ulURL),"string"!==typeof e.pingURL)throw"Ping URL string missing from server definition (pingURL)";if("/"!=e.pingURL.charAt(0)&&(e.pingURL="/"+e.pingURL),"string"!==typeof e.getIpURL)throw"GetIP URL string missing from server definition (getIpURL)";"/"!=e.getIpURL.charAt(0)&&(e.getIpURL="/"+e.getIpURL)}catch(t){throw console.error(t),"Invalid server definition"}},addTestPoint:function(e){if(this._checkServerDefinition(e),0==this._state&&(this._state=1),1!=this._state)throw"You can't add a server after server selection";this._settings.mpot=!0,this._serverList.push(e)},addTestPoints:function(e){for(var t=0;t<e.length;t++)this.addTestPoint(e[t])},loadServerList:function(e,t){if(0==this._state&&(this._state=1),1!=this._state)throw"You can't add a server after server selection";this._settings.mpot=!0;var r=new XMLHttpRequest;r.onload=function(){try{var e=JSON.parse(r.responseText);if(!e.status)return void t(null);e=e.data;for(var i=0;i<e.length;i++)e[i].dlURL="/speed/api/download",e[i].ulURL="/speed/api/empty",e[i].pingURL="/speed/api/empty",e[i].getIpURL="/speed/api/ip",this._checkServerDefinition(e[i]);this.addTestPoints(e),t(e)}catch(n){console.error(n),t(null)}}.bind(this),r.onerror=function(){t(null)},r.open("GET",e),r.send()},getSelectedServer:function(){if(this._state<2||null==this._selectedServer)throw"No server is selected";return this._selectedServer},setSelectedServer:function(e){if(this._checkServerDefinition(e),3==this._state)throw"You can't select a server while the test is running";this._selectedServer=e,this._state=2},selectServer:function(e){if(1!=this._state){if(0==this._state)throw"No test points added";if(2==this._state)throw"Server already selected";if(this._state>=3)throw"You can't select a server while the test is running"}if(this._selectServerCalled)throw"selectServer already called";this._selectServerCalled=!0;for(var t=function(e,t){var r=2e3,i=!0;/MSIE.(\d+\.\d+)/i.test(navigator.userAgent)&&(i=!1);var n=function(e,t){e+=(e.match(/\?/)?"&":"?")+"cors=true";var n=new XMLHttpRequest,s=(new Date).getTime();if(n.onload=function(){if(0==n.responseText.length){var r=(new Date).getTime()-s;try{var i=performance.getEntriesByName(e);i=i[i.length-1];var o=i.responseStart-i.requestStart;o<=0&&(o=i.duration),o>0&&o<r&&(r=o)}catch(a){console.error(a)}t(r)}else t(-1)}.bind(this),n.onerror=function(){t(-1)}.bind(this),n.open("GET",e),i)try{n.timeout=r,n.ontimeout=n.onerror}catch(o){console.error(o)}n.send()}.bind(this),s=3,o=500,a=function(e,t){var r=0;if(e.pingT=-1,-1==e.server.indexOf(location.protocol))t();else{var i=function(){r++!=s?n(e.server+e.pingURL,function(r){r>=0?((r<e.pingT||-1==e.pingT)&&(e.pingT=r),r<o?i():t()):t()}.bind(this)):t()}.bind(this);i()}}.bind(this),l=0,d=function(){for(var r=null,i=0;i<e.length;i++)-1!=e[i].pingT&&(null==r||e[i].pingT<r.pingT)&&(r=e[i]);t(r)}.bind(this),u=function(){l!=e.length?a(e[l++],u):d()}.bind(this);u()}.bind(this),r=6,i=[],n=0;n<r;n++)i[n]=[];for(var s=0;s<this._serverList.length;s++)i[s%r].push(this._serverList[s]);for(var o=0,a=null,l=0;l<r;l++)t(i[l],function(t){null!=t&&(null==a||t.pingT<a.pingT)&&(a=t),o++,o==r&&(this._selectedServer=a,this._state=2,e&&e(a))}.bind(this))},start:function(){if(3==this._state)throw"Test already running";if(this.worker=new u,this.worker.onmessage=function(e){if(e.data!==this._prevData){this._prevData=e.data;var t=JSON.parse(e.data);try{this.onupdate&&this.onupdate(t)}catch(e){console.error("Speedtest onupdate event threw exception: "+e)}if(t.testState>=4){try{this.onend&&this.onend(5==t.testState)}catch(e){console.error("Speedtest onend event threw exception: "+e)}clearInterval(this.updater),this._state=4}}}.bind(this),this.updater=setInterval(function(){this.worker.postMessage("status")}.bind(this),200),1==this._state)throw"When using multiple points of test, you must call selectServer before starting the test";2==this._state&&(this._settings.url_dl=this._selectedServer.server+":"+this._selectedServer.port+this._selectedServer.dlURL,this._settings.url_ul=this._selectedServer.server+":"+this._selectedServer.port+this._selectedServer.ulURL,this._settings.url_ping=this._selectedServer.server+":"+this._selectedServer.port+this._selectedServer.pingURL,this._settings.url_getIp=this._selectedServer.server+":"+this._selectedServer.port+this._selectedServer.getIpURL,this._settings.server_id=this._selectedServer.id,"undefined"!==typeof this._originalExtra?this._settings.telemetry_extra=JSON.stringify({server:this._selectedServer.name,extra:this._originalExtra}):this._settings.telemetry_extra=JSON.stringify({server:this._selectedServer.name})),this._state=3,this.worker.postMessage("start "+JSON.stringify(this._settings))},abort:function(){if(this._state<3)throw"You cannot abort a test that's not started yet";this._state<4&&this.worker.postMessage("abort")}};var h=c,p="http://127.0.0.1:8080",f={name:"Speedtest",data:function(){return{s:new h,pointReady:!1,uiData:null,startButtonType:"primary",startButtonForbidden:!0,startButtonStart:!1,ipAndIspContent:"",ipPositionAndAccessMethodContent:"",dlText:0,ulText:0,pingText:0,jitterText:0,serverLists:[],changeServerId:1}},methods:{startStop:function(){var e=this;this.pointReady&&(3==this.s.getState()?(this.s.abort(),this.startButtonType="primary",this.startButtonStart=!1,this.initUI()):(this.startButtonType="danger",this.startButtonStart=!0,this.s.onupdate=function(t){e.uiData=t},this.s.onend=function(){e.startButtonType="primary",e.startButtonStart=!1,e.updateUI(!0)},this.s.start()))},initUI:function(){var e=/Trident.*rv:(\d+\.\d+)/i.test(navigator.userAgent)?"#EAEAEA":"#80808040",t="#6060AA",r="#616161";this.drawMeter(this.I("dlMeter"),0,e,t,0),this.drawMeter(this.I("ulMeter"),0,e,r,0)},updateUI:function(e){var t=/Trident.*rv:(\d+\.\d+)/i.test(navigator.userAgent)?"#EAEAEA":"#80808040",r="#6060AA",i="#616161",n=t;if((e||3==this.s.getState())&&null!=this.uiData){var s=this.uiData.testState,o="";this.uiData.clientIp.length&&this.uiData.isp.length&&(o="-"),this.ipAndIspContent=this.uiData.clientIp+o+this.uiData.isp,o=this.uiData.ipPosition.length&&this.uiData.ipAccessMethod.length?"-":"",this.ipPositionAndAccessMethodContent=this.uiData.ipPosition+o+this.uiData.ipAccessMethod,this.dlText=1==s&&0==this.uiData.dlStatus?"...":this.format(this.uiData.dlStatus),this.drawMeter(this.I("dlMeter"),this.mbpsToAmount(Number(this.uiData.dlStatus*(1==s?this.oscillate():1))),t,r,Number(this.uiData.dlProgress),n),this.ulText=3==s&&0==this.uiData.ulStatus?"...":this.format(this.uiData.ulStatus),this.drawMeter(this.I("ulMeter"),this.mbpsToAmount(Number(this.uiData.ulStatus*(3==s?this.oscillate():1))),t,i,Number(this.uiData.ulProgress),n),this.pingText=this.format(this.uiData.pingStatus),this.jitterText=this.format(this.uiData.jitterStatus)}},I:function(e){return document.getElementById(e)},mbpsToAmount:function(e){return 1-1/Math.pow(1.3,Math.sqrt(e))},format:function(e){return e=Number(e),e<10?e.toFixed(2):e<100?e.toFixed(1):e.toFixed(0)},oscillate:function(){return 1+.02*Math.sin(Date.now()/100)},drawMeter:function(e,t,r,i,n,s){var o=e.getContext("2d"),a=window.devicePixelRatio||1,l=e.clientWidth*a,d=e.clientHeight*a,u=.0055*d;e.width==l&&e.height==d?o.clearRect(0,0,l,d):(e.width=l,e.height=d),o.beginPath(),o.strokeStyle=r,o.lineWidth=12*u,o.arc(e.width/2,e.height-58*u,e.height/1.8-o.lineWidth,1.1*-Math.PI,.1*Math.PI),o.stroke(),o.beginPath(),o.strokeStyle=i,o.lineWidth=12*u,o.arc(e.width/2,e.height-58*u,e.height/1.8-o.lineWidth,1.1*-Math.PI,t*Math.PI*1.2-1.1*Math.PI),o.stroke(),"undefined"!==typeof n&&(o.fillStyle=s,o.fillRect(.3*e.width,e.height-16*u,.4*e.width*n,4*u))},frame:function(){requestAnimationFrame(this.frame),this.updateUI()},changeServer:function(e){e--,this.s.setSelectedServer(this.s._serverList[e])}},mounted:function(){var e=this;this.frame(),this.s.loadServerList(p+"/api/testpoint?cors=1",(function(t){if(null==t)return e.changeServerId="测速节点加载失败",void alert("测速节点列表加载失败");e.changeServerId=t[0].id,e.startButtonForbidden=!1,e.s.setSelectedServer(t[0]),e.serverLists=t,e.pointReady=!0,e.startButtonType="primary"}))}},g=f,v=r("2877"),m=Object(v["a"])(g,o,a,!1,null,"f8b0cfec",null),_=m.exports,y={name:"App",components:{Speedtest:_}},b=y,S=Object(v["a"])(b,n,s,!1,null,null,null),w=S.exports,T=r("5c96"),x=r.n(T);r("0fae");i["default"].config.productionTip=!1,i["default"].use(x.a),new i["default"]({render:function(e){return e(w)}}).$mount("#app")}});
//# sourceMappingURL=index.0fed1e29.js.map